@model shareurstorydb.StoriesListModel
@using System.Configuration

@{
    ViewBag.Title = "View Post";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="@Url.Content("~/Scripts/app-viewpost.js")" language="javascript" type="text/javascript"></script>

<div id="fb-root"></div>
<script src="http://connect.facebook.net/en_US/all.js#appId=@ViewData["AppID"]&amp;xfbml=1"></script>
<script type="text/javascript">
    FB.Event.subscribe('edge.create', function (href, widget) {
        $.ajax({
            url: '@Html.Raw(ConfigurationManager.AppSettings["UrlForFacebook"].ToString() + "/Home/FBLike")',
            data: { id: @Model.Stories[0].ID },
            success: function (response) {
                var test = 'test';
            },
            error: function (e) {
                alert(e.responseText);
            }
        });

    });

    FB.Event.subscribe('edge.remove',
      function(response) {
          $.ajax({
              url: '@Html.Raw(ConfigurationManager.AppSettings["UrlForFacebook"].ToString() + "/Home/FBUnlike")',
              data: { id: @Model.Stories[0].ID },
              success: function (response) {
                  var test = 'test';
              },
              error: function (e) {
                  alert(e.responseText);
              }
          });
      }
    );

    function fbs_click() {
        $.ajax({
            url: '@Html.Raw(ConfigurationManager.AppSettings["UrlForFacebook"].ToString() + "/Home/FBShare")',
            data: { id: @Model.Stories[0].ID },
            success: function (response) {
                var test = 'test';
            },
            error: function (e) {
                alert(e.responseText);
            }
        });
    }

    $(document).ready(function(){
        $("#AddToFavorite").click(function(e){
            e.preventDefault();
            //$.get("/Home/Favorite",function(data,status){
            //});
        });
    });

</script>

<div class="containerBig">
    <div class="containerInner">
        <div class="containerTitle">
            <div class="containerTitleText">
                @Html.Raw(Model.Stories[0].Title) </div>
            <div class="containerTitleSubText">
                by @Html.ActionLink(Model.Stories[0].Name.ToString(), "Stories", new { u = Model.Stories[0].UserId }) &nbsp;
                @if (Session["User"] != null)
                {
                    <a id="AddToFollow" href="javascript:bla()" style="font-size:75%">Follow</a>
                }
            </div>
        </div>
        <div style="clear:both;"></div>
        <div class="containerStory">
            <div style="float:left;">
                <div style="float:left; width:90px; overflow:hidden;">
                    <fb:like href='@Html.Raw(ConfigurationManager.AppSettings["UrlForFacebook"].ToString() + "/Home/@Model.Stories[0].ID")' send="false" layout="button_count" show_faces="false" font="lucida grande" />
                </div>
                <div style="float:left;">
                    <style> html .fb_share_button { display: -moz-block; display:block; color:#3B5998; line-height:18px; width:60px; height:21px; background:url('/Content/images/fbshare_bg.jpg') no-repeat top right; background-size: 60px 20px; margin-left:5px; padding-top:1px; }</style>
                    <a rel="nofollow" href='@Html.Raw("http://www.facebook.com/share.php?u=u=" + ConfigurationManager.AppSettings["UrlForFacebook"].ToString() + "/Home/ViewPost/" + Model.Stories[0].ID.ToString())'
                       class="fb_share_button" onclick="return fbs_click()" target="_blank" style="text-decoration:none;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Share</a>
                </div>
            </div>
            <div style="float:right;">
                <b>Created Date:</b> @Html.Raw(Model.Stories[0].CreateDate.ToString("MMMM dd, yyyy")) &nbsp;|&nbsp;
                <b>Likes:</b> @Html.Raw(Model.Stories[0].Likes.ToString())
                @if (Session["User"] != null)
                {
                    <a id="AddToFavorite" href="">@Html.Raw(Model.Stories[0].FaveLabel.ToString())</a>
                }
            </div>
            <div style="clear:both; height:10px;"></div>

            <p>@Html.Raw(Model.Stories[0].Post)</p>
            <div style="clear:both; height:20px;"></div>
        </div>
        <div class="containerTitle">
            <div class="containerTitleText">Comments</div>
        </div>
        <div style="clear:both;"></div>
        <div class="">
            <script type="text/javascript" src='@Url.Content("~/Scripts/tiny_mce/tiny_mce.js")'></script>
            <script type="text/javascript">
                tinyMCE.init({
                    // General options
                    mode: "textareas",
                    theme: "advanced",
                    skin: "o2k7",
                    plugins: "autolink,lists,pagebreak,style,layer,table,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,inlinepopups",

                    // Theme options
                    theme_advanced_buttons1: "bold,italic,underline,|,bullist,numlist",
                    theme_advanced_buttons2: "",
                    theme_advanced_buttons3: "",
                    theme_advanced_toolbar_location: "top",
                    theme_advanced_toolbar_align: "left",
                    theme_advanced_resizing: true,

                    // Example word content CSS (should be your site CSS) this one removes paragraph margins
                    content_css: "css/word.css",

                    // Drop lists for link/image/media/template dialogs
                    template_external_list_url: "lists/template_list.js",
                    external_link_list_url: "lists/link_list.js",
                    external_image_list_url: "lists/image_list.js",
                    media_external_list_url: "lists/media_list.js",

                    // Replace values for the template plugin
                    template_replace_values: {
                        username: "Some User",
                        staffid: "991234"
                    }
                });
            </script>

            @using (Html.BeginForm("ViewPost", "Home"))
            {
                @Html.HiddenFor(model => model.Stories[0].ID, new { id = "hdnStoryID", name = "hdnStoryID" })
                @Html.TextArea("txtComment", new { id = "txtComment", style = "width: 100%; height:80px;" })
                <br />
                <input type="submit" value="Comment" name="btnSubmit" id="btnSubmit" /><span id="lblErrorLogin" style="display:none;"><i>*Please login using the Facebook login button at the top right of this page to post your comment.</i></span>
                <script language="javascript" type="text/javascript">
                    $(document).ready(function () {
                        if ($("#hdnUserID").val() == "0") {
                            $('input[name="btnSubmit"]').attr('disabled', 'disabled');
                            $("#lblErrorLogin").css("display", "block");
                        }
                    });
                </script>
            }
        </div>

        <div style="clear:both; height:30px;"></div>

        @foreach (var comment in Model.Comments)
        {
            <div class="containerTitle"><div class="containerTitleText" style="font-size:14px;">Comment by  @Html.Raw(comment.Name)</div><div class="containerTitleSubText">@Html.Raw(comment.CreateDate.ToString("MMMM dd, yyyy"))</div></div>
            <div style="clear:both;"></div>
            <div class="containerStory">
                <div class="storyTitle"></div>
                <div class="storyText">@Html.Raw(comment.Comment)</div>
                <div style="clear:both;"></div>
            </div>
            <div style="clear:both; height:10px;"></div>
        }
    </div>
</div>